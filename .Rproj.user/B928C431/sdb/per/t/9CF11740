{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Learning Network Analysis\"\noutput:\n  html_notebook: default\n---\n# Notes on Network Analysis\n\n\\section{Install Packages}\n```{r, echo=TRUE, message=FALSE, warning=FALSE}\n# Install Packages\n# install.packages(\"igraph\") \n# install.packages(\"network\") \n# install.packages(\"sna\")\n# install.packages(\"visNetwork\")\n# install.packages(\"ndtv\", dependencies=T)\n# install.packages(\"RColorBrewer\")\n# install.packages(\"extrafont\")\n# install.packages(\"png\")\n# install.packages(\"animation\")\n# install.packages(\"maps\")\n# install.packages(\"geosphere\")\nlibrary(dplyr)\n```\n\n\\section{Load data samples and understand network datasets}\n### One mode network dataset\n```{r}\n# Load data sample 1 (data frame)\nnodes <- read.csv(\"Data files/Dataset1-Media-Example-NODES.csv\", header=T, as.is=T)\nlinks <- read.csv(\"Data files/Dataset1-Media-Example-EDGES.csv\", header=T, as.is=T)\n```\n```{r, echo=TRUE}\n# Preview the data structure\nhead(nodes)\nhead(links)\n# The number of nodes and links is the grain for the two data frames; hence aggregation is needed if rows are not unique\n# nrow(nodes); length(unique(nodes$id))\n# nrow(links); nrow(unique(links[,c(\"from\", \"to\")]))\n```\n\nNotice that in data sample 1, the links are among nodes within one group. This type of data set examines the relationships among one group of entities. Also, the links are directional, meaning the data set will allow links between two nodes from opposite directions.\n\n```{r, echo=TRUE, message=FALSE, warning=FALSE}\n# Collapse multiple links of the same type between the same two nodes\n# by summing their weights, using aggregate() by \"from\", \"to\", & \"type\":\nlinks <- aggregate(links[,3], by = links[,-3], FUN = sum) # aggregate \"weight\" by \"from\", \"to\", \"mention\"\nlinks <- links[order(links$from, links$to),]\ncolnames(links)[4] <- \"weight\"\nrownames(links) <- NULL # Otherwise the ordered index would be the row names by default\n```\nFor this kind of dataset, one has to make sure that:\n\n* Both nodes and links are stored in a data frame\n* The nodes (entities) and the links (\"from\" + \"to\") are unique\n* Nodes and links should have matching ID (keys)\n* Both nodes and links can have extra features such as type (categorical) and size/weight (continuous) as modifiers\n\n```{r}\n# Load data sample 2 (matrix)\nnodes2 <- read.csv(\"./Data files/Dataset2-Media-User-Example-NODES.csv\", header=T, as.is=T)\nlinks2 <- read.csv(\"./Data files/Dataset2-Media-User-Example-EDGES.csv\", header=T, row.names=1)\nhead(nodes2)\nhead(links2)\n```\n\n```{r}\n# Transfer links2 into a matrix\nlinks2 <- as.matrix(links2)\ndim(links2)\ndim(nodes2)\n```\nWe can see that links2 is an adjacency matrix for a two-mode network. Two-mode or bipartite graphs have two different types of actors and links that go across, but not within each type. Our second media example is a network of that kind, examining links between news sources and their consumers.\n\nFor this kind of dataset, one has to make sure that:\n\n*  Nodes dataset is still a data frame, while links dataset should be a matrix\n*  The unique count of entities in nodes equals number of rows and columns in links (number of entities in group A + group B)\n*  Nodes and links have matching keys\n\n\\section{plot networks}\nAfter setting up the dataset, we can start plotting the graphs using the \"igraph\" package. First we need to converting the data to an igraph object:\n\n* The **graph_from_data_frame()** function takes two data frames: 'd' and 'vertices'.\n    + 'd' describes the edges of the network - it should start with two columns containing the source and target node IDs for each network tie\n    + 'vertices' should start with a column of node IDs\n    + any additional columns in either data frame are interpreted as attributes.\n\n```{r}\n# Create a igraph object\nlibrary(igraph)\nnet <- graph_from_data_frame(d=links, vertices=nodes, directed=T) \nclass(net) # Check the class\n\nE(net)\nV(net)\nE(net)$type\nV(net)$media\n```\nFor the data sample 2, we need to use another function from the igraph package, i.e. **graph_from_incidence_matrix()**. \n```{r}\nnet2 <- graph_from_incidence_matrix(links2)\n```\nAfter creating the igraph object, we can plot it.\n```{r fig.height=6, fig.width=6}\nplot(net) # Raw graph\nnet <- simplify(net, remove.multiple = F, remove.loops = T)\n# Remove node label and create smaller arrows\nplot(net, edge.arrow.size=.4, vertex.label=NA)\n\n# Show two directions with curved edges\nplot(net, edge.arrow.size=.4, edge.curved=.1)\n\n# Edge color to light grey, node/border colour to organge, show real names for the nodes\nplot(net, edge.arrow.size=.2, edge.color=\"orange\",\n     vertex.color = \"orange\", vertex.frame.color=\"#ffffff\",\n     vertex.label=V(net)$media, vertex.label.color=\"black\")\n```\nMore advanced plotting involves adding more feature to the igraph object.\n```{r}\n# Colors based on media type\ncolrs <- c(\"gray50\", \"tomato\", \"gold\")\nV(net)$color <- colrs[V(net)$media.type]\n\n# Compute node degrees (#links) and use that to set node size:\ndeg <- degree(net, mode = \"all\")\nV(net)$size <- deg*3\n# Or the audience size value as size:\nV(net)$size <- V(net)$audience.size*0.6\n\n# Adjust labels to NA:\nV(net)$label <- NA\n\n# Set edge widge based on weight:\nE(net)$width <- E(net)$weight/6\n\n# Change the arrow size and edge color:\nE(net)$arrow.size <- .2\nE(net)$edge.color <- \"gray80\"\nE(net)$width <- 1 + E(net)$weight/12\n```\n```{r}\nplot(net)\n# Overwrite the attr in the plot:\n# plot(net, edge.color=\"orange\", vertex.color=\"gray50\")\n\n# Create a legend to explain\nlegend(x=-1.5, y=-1.1, c(\"Newspaper\", \"Television\",\"Online News\"),\n       pch=21, col=\"#777777\", pt.bg = colrs, pt.cex = 2, cex = .8,\n       bty=\"n\", ncol=1)\n```\n```{r}\n# Semantic networks to plot only the labels\nplot(net, vertex.shape=\"none\", vertex.label=V(net)$media,\n     vertex.label.font=2, vertex.label.color=\"gray40\", \n     vertex.label.cex=.7, edge.color=\"gray85\")\n\n```\n\n",
    "created" : 1481316626940.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2555621142",
    "id" : "9CF11740",
    "lastKnownWriteTime" : 1490877442,
    "last_content_update" : 1490877442830,
    "path" : "C:/Users/oycy/Google Drive/R Projects/network analysis prep/network analysis notebook.Rmd",
    "project_path" : "network analysis notebook.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}